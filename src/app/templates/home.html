<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limbus Company Progress</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; background-color: #f8f9fa; color: #212529; }
        .banner { background-color: #007bff; color: white; padding: 10px; text-align: center; }
        .banner form { display: inline; }
        .banner input[type="submit"] { background-color: #0056b3; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .container { background-color: white; padding: 2em; margin: 2em auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 800px; }
        h1, h2, h3 { color: #343a40; }
        hr { border: 0; height: 1px; background-color: #e9ecef; margin: 2em 0; }
        .progress-bar-container { width: 100%; background-color: #e9ecef; border-radius: 4px; }
        .progress-bar { height: 24px; background-color: #28a745; text-align: center; color: white; line-height: 24px; border-radius: 4px; transition: width 0.4s ease-in-out; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: .5rem; font-weight: 500; }
        select, input[type="number"], input[type="submit"] { width: 100%; padding: .5rem; margin-top: .25rem; border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box; }
        input[type="submit"] { background-color: #007bff; color: white; cursor: pointer; border: none; font-size: 1rem; }
        input[type="submit"]:hover { background-color: #0056b3; }
        ul { list-style-type: none; padding: 0; }
        li { background-color: #f8f9fa; padding: 10px; border-radius: 4px; margin-bottom: 5px; }
        .toggle-switch { display: flex; border: 1px solid #ced4da; border-radius: 4px; overflow: hidden; }
        .toggle-switch input[type="radio"] { display: none; }
        .toggle-switch label { flex: 1; text-align: center; padding: .5rem; cursor: pointer; background-color: #f8f9fa; transition: background-color 0.2s; }
        .toggle-switch input[type="radio"]:checked + label { background-color: #007bff; color: white; }
    </style>
</head>
<body>
    <div class="banner">
        <form action="{{ url_for('update_items_from_github') }}" method="post">
            <input type="submit" value="Update Items from GitHub">
        </form>
    </div>

    <div class="container">
        <h1>Limbus Company Progress Tracker</h1>
        <hr>

        <h2>Manually Update E.G.O. Level</h2>
        <form action="{{ url_for('update_ego_level') }}" method="post">
            <div class="form-group">
                <label for="sinner">Sinner:</label>
                <select id="sinner" name="sinner" required>
                    <option value="">-- Select a Sinner --</option>
                    {% for sinner in sinners.sinners %}
                        <option value="{{ sinner.name }}">{{ sinner.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="ego">E.G.O:</label>
                <select id="ego" name="E.G.O." required>
                    <option value="">-- Select an E.G.O. --</option>
                </select>
            </div>
            <div class="form-group">
                <label>New Uptie Level:</label>
                <div class="toggle-switch">
                    <input type="radio" id="level0" name="new_level" value="0" required><label for="level0">Unobtained</label>
                    <input type="radio" id="level1" name="new_level" value="1"><label for="level1">1</label>
                    <input type="radio" id="level2" name="new_level" value="2"><label for="level2">2</label>
                    <input type="radio" id="level3" name="new_level" value="3"><label for="level3">3</label>
                    <input type="radio" id="level4" name="new_level" value="4"><label for="level4">4</label>
                </div>
            </div>
            <input type="submit" value="Update E.G.O. Level">
        </form>

        <hr>

        <a href="{{ url_for('visualizer') }}" class="button" style="display: block; text-align: center; margin-bottom: 1rem;">View Progress</a>

    </div>

    <script>
        const sinnerEgoMap = {
            {% for sinner in all_sinners_data.sinners %}
                "{{ sinner.name }}": [{% for ego in sinner.egos %}{"id": "{{ ego.id }}", "name": "{{ ego.name }}"}{% if not loop.last %}, {% endif %}{% endfor %}],
            {% endfor %}
        };

        const sinnerSelect = document.getElementById('sinner');
        const egoSelect = document.getElementById('ego');

        sinnerSelect.addEventListener('change', function() {
            const selectedSinner = this.value;
            const egos = sinnerEgoMap[selectedSinner] || [];

            // Clear previous options
            egoSelect.innerHTML = '<option value="">-- Select an E.G.O. --</option>';

            // Add new options
            egos.forEach(function(ego) {
                const option = document.createElement('option');
                option.value = ego.id; // Use ego.id for the value
                option.textContent = ego.name; // Use ego.name for the display text
                egoSelect.appendChild(option);
            });
        });
    </script>
</body>
</html>